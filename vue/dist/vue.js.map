{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/utils.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayPrototype = Array.prototype;\r\nexport let arrayMethods = Object.create(oldArrayPrototype);\r\nlet methods = [\r\n    'push',\r\n    'shift',\r\n    'unshift',\r\n    'pop',\r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method =>{\r\n    arrayMethods[method] = function(...args){\r\n        console.log('数组改变了');\r\n        oldArrayPrototype[method].call(this,...args);\r\n        // 通过push、unshift、splice方法也可能对数据进行更改\r\n        let po = this.__po__;\r\n        let inserted;\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args;\r\n                break;\r\n            case 'splice':\r\n                inserted = args.slice(2);\r\n                break;\r\n        }\r\n        if(inserted) {\r\n            po.observeArray(inserted);\r\n        }\r\n    }\r\n})","export function isFunction(val) { \r\n    return typeof val === 'function';\r\n}\r\n\r\nexport function isObject(val) {\r\n   return typeof val === 'object'&& val!==null;\r\n}","import {arrayMethods} from \"./array\";\r\nimport { isObject } from \"../utils\";\r\n\r\n// 创建观测者\r\nclass Observer{\r\n    constructor(data){\r\n        // data.__po__ = this;\r\n        Object.defineProperty(data,'__po__',{\r\n            value:this,\r\n            enumerable:false\r\n        })\r\n        if(Array.isArray(data)){\r\n            data.__proto__ = arrayMethods;\r\n            this.observeArray(data);\r\n        }\r\n        else {\r\n        //对对象中的所有属性进行劫持\r\n        this.walk(data);\r\n        }\r\n    }\r\n    // 如果数组中包含对象，则再次被监控\r\n    observeArray(data){\r\n        data.forEach(item =>{\r\n            observe(data);\r\n        })\r\n    }\r\n    walk(data){\r\n        Object.keys(data).forEach(key =>{\r\n          defineReactive(data,key,data[key]);\r\n        })\r\n    }\r\n}\r\nfunction defineReactive(data,key,value){\r\n    observe(value)\r\n    Object.defineProperty(data,key,{\r\n        get(){\r\n            return value;\r\n        },\r\n        set(newV) {\r\n            // observe(value)\r\n            value = newV;\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe(data) {\r\n    // 判断数据是否为对象\r\n    if(!isObject(data)){\r\n        return ;\r\n    }\r\n    if(data.__po__){\r\n        return ;\r\n    }\r\n    //创建观测者来观测数据\r\n    return new Observer(data);\r\n}","\r\nimport { observe } from \"./observer/index\";\r\nimport { isFunction } from \"./utils\";\r\n\r\nexport function initState(vm){\r\n    const opts = vm.$options;\r\n    if(opts.data){\r\n        // 数据存在，则劫持数据\r\n        initData(vm);\r\n        \r\n    }\r\n}\r\n\r\nfunction proxy(vm,source,key){\r\n    Object.defineProperty(vm,key,{\r\n        get(){\r\n            return vm[source][key];\r\n        },\r\n        set(newV){\r\n            vm[source][key] = newV;\r\n        }\r\n    })\r\n}\r\nfunction initData(vm){\r\n    let data = vm.$options.data;\r\n    // 判断data是函数还是对象,获取其对象数据\r\n    data = vm._data =  isFunction(data)?data(vm):data;\r\n    // 将数据挂载到vm上\r\n    for(let key in data){\r\n        proxy(vm,'_data',key);\r\n    }\r\n    //观察数据\r\n    observe(data);\r\n}","import { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue){\r\n    // 在Vue类的原型上添加这个函数\r\n    Vue.prototype._init = function(options){\r\n        const vm = this;\r\n        // 在原型上添加一个属性保存数据\r\n        vm.$options = options;//\r\n        //开始对数据进行劫持\r\n        initState(vm);\r\n    }\r\n}","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n    //options 为传入的选项\r\n    this._init(options)\r\n}\r\ninitMixin(Vue);\r\n\r\nexport default Vue;"],"names":["oldArrayPrototype","Array","prototype","arrayMethods","Object","create","methods","forEach","method","console","log","args","call","po","__po__","inserted","slice","observeArray","isFunction","val","isObject","Observer","data","defineProperty","value","enumerable","isArray","__proto__","walk","item","observe","keys","key","defineReactive","get","set","newV","initState","vm","opts","$options","initData","proxy","source","_data","initMixin","Vue","_init","options"],"mappings":"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"}